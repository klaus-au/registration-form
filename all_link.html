<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All link</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Georgia', serif;
            background: #2c1b12;
            color: #fff;
            overflow-x: hidden;
            perspective: 1000px;
        }
        #errorMessage {
            color: #b91c1c;
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fee2e2;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        #loadingSpinner {
            display: none;
            width: 3rem;
            height: 3rem;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23f59e0b" stroke-width="2"><path d="M12 4v4m0 8v4M4 12h4m8 0h4M5.172 5.172l2.828 2.828m8 8l2.828 2.828M5.172 18.828l2.828-2.828m8-8l2.828-2.828"/></svg>') center/cover;
            animation: flipBook 1s linear infinite;
        }
        @keyframes flipBook {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        .bookshelf {
            background: linear-gradient(180deg, #3c2f2f, #2c1b12);
            padding: 2rem;
            transform: translateZ(-100px);
            position: relative;
            z-index: 1;
        }
        .book {
            width: 10rem;
            height: 14rem;
            background: linear-gradient(90deg, #1a120b 10%, #4a3728 90%);
            border: 2px solid #d4af37;
            border-radius: 0.25rem 0.5rem 0.5rem 0.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: transform 0.6s ease;
            transform-style: preserve-3d;
            will-change: transform;
        }
        .book.open {
            transform: rotateY(-90deg);
        }
        .book-content {
            position: absolute;
            top: 0;
            left: 100%;
            width: 12rem;
            height: 14rem;
            background: #f5f5f5;
            border: 2px solid #d4af37;
            border-radius: 0 0.5rem 0.5rem 0;
            padding: 1rem;
            display: none;
            flex-wrap: wrap;
            gap: 0.5rem;
            transform: rotateY(90deg);
            transform-origin: left;
            color: #1a120b;
        }
        .book-content.open {
            display: flex;
        }
        .bookmark {
            width: 4rem;
            height: 2rem;
            background: linear-gradient(45deg, var(--color), var(--hover));
            clip-path: polygon(0 0, 80% 0, 100% 50%, 80% 100%, 0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            animation: wave 2s ease-in-out infinite;
            will-change: box-shadow;
        }
        .bookmark::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.5), transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .bookmark:hover:not(.cursor-not-allowed)::after {
            opacity: 1;
        }
        @keyframes wave {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(2px); }
        }
        .title-svg {
            stroke: #f59e0b;
            stroke-width: 2;
            fill: none;
            stroke-dasharray: 200;
            stroke-dashoffset: 200;
            animation: draw 3s ease forwards;
        }
        @keyframes draw {
            to { stroke-dashoffset: 0; }
        }
        canvas#dust {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
        }
        .parallax {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen p-4">
    <canvas id="dust"></canvas>
    <h1 class="mb-8">
        <svg class="w-48 h-16 sm:w-64 sm:h-20" viewBox="0 0 200 50">
            <path class="title-svg" d="M10 40 Q20 10 30 40 M40 40 Q50 10 60 40 M70 10 V40 M80 10 V40 H90 M110 40 Q120 10 130 40 M140 10 V40 H150 M160 10 V40 H170 M180 10 V40" />
        </svg>
    </h1>
    <div id="errorMessage" class="text-sm sm:text-base">
        <span id="errorText"></span>
        <button onclick="document.getElementById('errorMessage').style.display = 'none'" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">✕</button>
    </div>
    <div id="loadingSpinner" class="mb-6"></div>
    <div id="buttonContainer" class="bookshelf w-full grid gap-6 sm:grid-cols-2 max-w-5xl parallax"></div>

    <script>
        // Google Sheet 連結: https://docs.google.com/spreadsheets/d/1P28ZlLqSFk64xTX9bVg2sSCOSj1kCp7blzBvIWfgT_w/edit?gid=0#gid=0
        const spreadsheetId = '1P28ZlLqSFk64xTX9bVg2sSCOSj1kCp7blzBvIWfgT_w';
        const sheetName = 'Sheet1'; // 請確認工作表名稱，若不同請修改
        const apiUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?tqx=out:json&tq=SELECT%20*%20WHERE%20A%20IS%20NOT%20NULL&sheet=${encodeURIComponent(sheetName)}`;

        // 漂浮灰塵粒子
        const canvas = document.getElementById('dust');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const dust = [];
        for (let i = 0; i < 50; i++) {
            dust.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 1 + 0.5,
                vx: Math.random() * 0.2 - 0.1,
                vy: Math.random() * 0.2 - 0.1
            });
        }
        function animateDust() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            dust.forEach(d => {
                d.x += d.vx;
                d.y += d.vy;
                if (d.x < 0 || d.x > canvas.width) d.vx *= -1;
                if (d.y < 0 || d.y > canvas.height) d.vy *= -1;
                ctx.beginPath();
                ctx.arc(d.x, d.y, d.radius, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 245, 220, 0.5)';
                ctx.fill();
            });
            requestAnimationFrame(animateDust);
        }
        animateDust();

        // 視差效果
        window.addEventListener('scroll', () => {
            const parallax = document.querySelector('.parallax');
            const scrollY = window.scrollY;
            parallax.style.transform = `translateZ(-100px) translateY(${scrollY * 0.1}px)`;
        });

        async function fetchSheetData() {
            const spinner = document.getElementById('loadingSpinner');
            spinner.style.display = 'block';
            try {
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`無法連接到 Google Sheets，HTTP 狀態碼：${response.status}`);
                }
                const text = await response.text();
                const jsonString = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*)\);/);
                if (!jsonString || !jsonString[1]) {
                    throw new Error('無效的 Google Sheets JSONP 回應，請檢查工作表是否公開。');
                }
                const data = JSON.parse(jsonString[1]);
                
                if (data.table && data.table.rows && data.table.rows.length > 1) {
                    updateButtons(data.table.rows);
                    document.getElementById('errorMessage').style.display = 'none';
                } else {
                    showError('工作表中無有效資料，請確保 A 欄從第 2 行開始有名稱資料，並檢查工作表名稱是否為 "' + sheetName + '"。');
                }
            } catch (error) {
                showError(`載入資料失敗：${error.message}。請確保 Google Sheet 已設為公開，且工作表名稱正確。`);
            } finally {
                spinner.style.display = 'none';
            }
        }

        function updateButtons(rows) {
            const container = document.getElementById('buttonContainer');
            container.innerHTML = ''; // 清空現有按鈕

            // 從第一行（標題行）獲取按鈕名稱
            const headers = rows[0].c.map((cell, index) => ({
                name: cell?.v || (index < 3 ? ['名稱', 'Form', 'Sheet'][index] : '未命名'),
                index: index
            })); // 包含 A、B、C 和 D 到 I 欄

            // 檢查 D 到 I 欄是否有資料（從第 2 行開始）
            const hasData = headers.slice(3).map((_, index) => {
                return rows.slice(1).some(row => row.c[3 + index]?.v); // 檢查 D2:D, E2:E 等
            });

            // 固定按鈕：Form (B) 和 Sheet (C)，加上有資料的 D 到 I 欄
            const activeButtons = [
                { name: 'Form', index: 1, color: 'bg-blue-500', hover: 'bg-blue-600', icon: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V19a2 2 0 01-2 2z' },
                { name: 'Sheet', index: 2, color: 'bg-green-500', hover: 'bg-green-600', icon: 'M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V19a2 2 0 01-2 2z' }
            ].concat(headers.slice(3).filter((_, i) => hasData[i]).map((header, i) => ({
                name: header.name,
                index: 3 + i,
                color: ['bg-purple-500', 'bg-indigo-500', 'bg-red-500', 'bg-teal-500', 'bg-orange-500', 'bg-pink-500'][i % 6],
                hover: ['bg-purple-600', 'bg-indigo-600', 'bg-red-600', 'bg-teal-600', 'bg-orange-600', 'bg-pink-600'][i % 6],
                icon: 'M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3'
            })));

            // 從第二行（A2 開始）處理資料
            rows.slice(1).forEach((row, rowIndex) => {
                const label = row.c[0]?.v; // A 欄：名稱
                if (label) { // 確保名稱存在
                    const bookContainer = document.createElement('div');
                    bookContainer.className = 'relative flex justify-center items-center';

                    // 書本
                    const book = document.createElement('div');
                    book.className = 'book';
                    book.innerHTML = `<span class="text-sm font-bold text-white transform -rotate-90 origin-center whitespace-nowrap">${label}</span>`;

                    // 書頁內容
                    const bookContent = document.createElement('div');
                    bookContent.className = 'book-content';
                    bookContent.id = `book-content-${rowIndex}`;

                    // 生成書籤按鈕
                    activeButtons.forEach(button => {
                        const link = row.c[button.index]?.v;
                        const bookmark = document.createElement('a');
                        bookmark.className = `bookmark flex items-center justify-center text-white text-xs ${link ? '' : 'bg-gray-300 cursor-not-allowed'}`;
                        bookmark.style = `--color: ${button.color}; --hover: ${button.hover};`;
                        bookmark.innerHTML = `
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${button.icon}" />
                            </svg>
                            ${button.name}
                        `;
                        if (link && typeof link === 'string') { // 檢查 link 是否為有效字串
                            bookmark.href = link.startsWith('http') ? link : `https://${link}`;
                            bookmark.target = '_blank';
                            bookmark.rel = 'noopener noreferrer';
                        }
                        bookContent.appendChild(bookmark);
                    });

                    // 點擊書本切換內容顯示
                    book.addEventListener('click', () => {
                        const isOpen = book.classList.contains('open');
                        document.querySelectorAll('.book.open').forEach(b => b.classList.remove('open'));
                        document.querySelectorAll('.book-content.open').forEach(c => c.classList.remove('open'));
                        if (!isOpen) {
                            book.classList.add('open');
                            bookContent.classList.add('open');
                        }
                    });

                    bookContainer.appendChild(book);
                    bookContainer.appendChild(bookContent);
                    container.appendChild(bookContainer);
                }
            });
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            document.getElementById('errorText').textContent = message;
            errorDiv.style.display = 'block';
        }

        // 初次載入資料
        fetchSheetData();
    </script>
</body>
</html>
